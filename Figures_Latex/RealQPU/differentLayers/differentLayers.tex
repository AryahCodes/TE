\documentclass[margin=5pt]{standalone}
\usepackage{pgfplots}
\usetikzlibrary{pgfplots.groupplots}
\pgfplotsset{compat=newest}
\usepackage{subcaption}
\usetikzlibrary{plotmarks}
\usepackage{palatino}
\newlength{\mainwidth}
\setlength{\mainwidth}{460pt}
\definecolor{color1}{HTML}{1b9e77}
\definecolor{color2}{HTML}{d95f02}
\definecolor{color3}{HTML}{7570b3}
\definecolor{color4}{HTML}{e7298a}
\definecolor{color5}{HTML}{66a61e}
\definecolor{color6}{HTML}{e6ab02}
\definecolor{color7}{HTML}{a6761d}

\begin{document}
\begin{tikzpicture}
\begin{groupplot}[
    group style={
        group size=3 by 1,
        horizontal sep=0.05\mainwidth,
        vertical sep=2cm,
    },
    width=0.4\mainwidth,
    height=0.3\mainwidth,
    xlabel=$x$,
    grid=major,
]
\nextgroupplot[
    ylabel=$u(x)$,
    title={4 Qubits 1 Layer},
]
\addplot[line width=1pt, opacity=0.4] table [x=x, y=u_state_1layers, col sep=space] {state_solution.dat};
\addplot[only marks, mark=diamond*, mark options={color=color1}] table [x=x, y=u_shots_1layers, col sep=space] {shots_solution.dat};
\addplot[only marks, mark=triangle*, mark options={color=color2}] table [x=x, y=u_noise_shots_1layers, col sep=space] {shots_solution.dat};
\addplot[only marks, mark=asterisk, mark options={color=color3}] table [x=x, y=u_real_1layers, col sep=space] {shots_solution.dat};

\nextgroupplot[
    title={4 Qubits 4 Layers},
]
\addplot[line width=1pt, opacity=0.4] table [x=x, y=u_state_4layers, col sep=space] {state_solution.dat};
\addplot[only marks, mark=diamond*, mark options={color=color1}] table [x=x, y=u_shots_4layers, col sep=space] {shots_solution.dat};
\addplot[only marks, mark=triangle*, mark options={color=color2}] table [x=x, y=u_noise_shots_4layers, col sep=space] {shots_solution.dat};
\addplot[only marks, mark=asterisk, mark options={color=color3}] table [x=x, y=u_real_4layers, col sep=space] {shots_solution.dat};

\nextgroupplot[
    title={4 Qubits 8 Layers},
    legend style={
        at={($(0.5,-0.4)$)},
        anchor=north,
        legend columns=4,
        /tikz/every even column/.append style={column sep=0.5cm},
    },
    legend to name=named,
]
\addplot[line width=1pt, opacity=0.4] table [x=x, y=u_state_8layers, col sep=space] {state_solution.dat};
\addplot[only marks, mark=diamond*, mark options={color=color1}] table [x=x, y=u_shots_8layers, col sep=space] {shots_solution.dat};
\addplot[only marks, mark=triangle*, mark options={color=color2}] table [x=x, y=u_noise_shots_8layers, col sep=space] {shots_solution.dat};
\addplot[only marks, mark=asterisk, mark options={color=color3}] table [x=x, y=u_real_8layers, col sep=space] {shots_solution.dat};

\legend{Simulated State Vector, Simulated Ideal Shots,Simulated Noisy Shots, Real Device}
\end{groupplot}

\node[below] at ($(group c1r1.south)!0.5!(group c3r1.south)-(0,0.8cm)$) {\ref{named}};

\end{tikzpicture}
\end{document}